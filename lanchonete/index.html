<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lanchonete - Cardápio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="css/index.css">
</head>
<body>
    <header>
        <div class="logo">
            <img src="imagens/logo" alt="Lanchonete" class="img-logo">
            <h1>Lanchonete Delícia</h1>
        </div>
        <nav>
            <ul>
                <li><a href="#" class="active">Cardápio</a></li>
                <li><a href="#">Meus Pedidos</a></li>
                <li><a href="#" id="account-settings">Minha Conta</a></li>
                <li><a href="#" id="logout">Sair</a></li>
            </ul>
        </nav>
        <div class="cart-icon" id="cart-icon">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count">0</span>
        </div>
    </header>

    <main>
        <section class="menu-categories">
            <button class="category-btn active" data-section="lanches">Lanches</button>
            <button class="category-btn" data-section="bebidas">Bebidas</button>
            <button class="category-btn" data-section="porcoes">Porções</button>
            <button class="category-btn" data-section="promocoes">Promoções</button>
        </section>

        <section class="menu-sections">
            <!-- Seção de Lanches -->
            <div class="menu-section active" id="lanches">
                <!-- Itens serão adicionados via JavaScript -->
            </div>
            
            <!-- Seção de Bebidas -->
            <div class="menu-section" id="bebidas">
                <!-- Itens serão adicionados via JavaScript -->
            </div>
            
            <!-- Seção de Porções -->
            <div class="menu-section" id="porcoes">
                <!-- Itens serão adicionados via JavaScript -->
            </div>
            
            <!-- Seção de Promoções -->
            <div class="menu-section" id="promocoes">
                <!-- Itens serão adicionados via JavaScript -->
            </div>
        </section>
    </main>

    <!-- Carrinho de Compras -->
    <div class="cart-sidebar" id="cart-sidebar">
        <div class="cart-header">
            <h3>Seu Pedido</h3>
            <span class="close-cart">&times;</span>
        </div>
        <div class="cart-items" id="cart-items">
            <!-- Itens serão adicionados aqui -->
        </div>
        <div class="cart-summary">
            <div class="summary-row">
                <span>Subtotal:</span>
                <span id="cart-subtotal">R$ 0,00</span>
            </div>
            <div class="summary-row">
                <span>Taxa de Entrega:</span>
                <span id="delivery-fee">R$ 5,00</span>
            </div>
            <div class="summary-row total">
                <span>Total:</span>
                <span id="cart-total">R$ 5,00</span>
            </div>
            <button class="btn btn-primary" id="checkout-btn">Finalizar Pedido</button>
        </div>
    </div>

    <!-- Modal de Configurações da Conta -->
    <div class="account-modal" id="account-modal">
        <div class="modal-content">
            <span class="close-account">&times;</span>
            <h2>Minha Conta</h2>
            <form id="account-form">
                <div class="form-group">
                    <label for="account-name">Nome Completo</label>
                    <input type="text" id="account-name" disabled>
                </div>
                <div class="form-group">
                    <label for="account-phone">Telefone</label>
                    <input type="text" id="account-phone">
                </div>
                <div class="form-group">
                    <label for="account-address">Endereço</label>
                    <input type="text" id="account-address">
                </div>
                <div class="form-group">
                    <label for="account-cpf">CPF</label>
                    <input type="text" id="account-cpf" placeholder="Opcional">
                </div>
                <div class="form-group">
                    <label for="account-password">Nova Senha (deixe em branco para não alterar)</label>
                    <input type="password" id="account-password">
                </div>
                <div class="form-group">
                    <label for="account-confirm-password">Confirmar Nova Senha</label>
                    <input type="password" id="account-confirm-password">
                </div>
                <button type="submit" class="btn btn-primary">Salvar Alterações</button>
            </form>
        </div>
    </div>

    <!-- Notificação de Item Adicionado -->
    <div class="notification" id="notification">
        <div class="notification-content">
            <span id="notification-message"></span>
        </div>
    </div>

    <script>
        // Dados do Cardápio
        const cardapio = {
            lanches: [
                { 
                    id: 1, 
                    nome: "X-Burger", 
                    descricao: "Pão, hambúrguer, queijo, alface e tomate", 
                    preco: 15.00, 
                    imagem: "imagens/lanche.jpg",
                    adicionais: [
                        { nome: "Bacon", preco: 3.00 },
                        { nome: "Ovo", preco: 2.00 },
                        { nome: "Queijo Extra", preco: 4.00 }
                    ]
                },
                { 
                    id: 2, 
                    nome: "X-Salada", 
                    descricao: "Pão, hambúrguer, queijo, alface, tomate e maionese", 
                    preco: 18.00, 
                    imagem: "imagens/lanche.jpg",
                    adicionais: [
                        { nome: "Bacon", preco: 3.00 },
                        { nome: "Ovo", preco: 2.00 }
                    ]
                },
                { 
                    id: 3, 
                    nome: "X-Bacon", 
                    descricao: "Pão, hambúrguer, queijo, bacon e molho especial", 
                    preco: 20.00, 
                    imagem: "imagens/lanche.jpg",
                    adicionais: [
                        { nome: "Cebola Caramelizada", preco: 2.50 },
                        { nome: "Queijo Extra", preco: 4.00 }
                    ]
                }
            ],
            bebidas: [
                { 
                    id: 10, 
                    nome: "Refri Lata", 
                    descricao: "350ml - Escolha o sabor", 
                    preco: 6.00, 
                    imagem: "imagens/refri.jpg",
                    adicionais: []
                },
                { 
                    id: 11, 
                    nome: "Suco Natural", 
                    descricao: "500ml - Laranja, Abacaxi ou Maracujá", 
                    preco: 8.00, 
                    imagem: "imagens/suco.jpg",
                    adicionais: []
                }
            ],
            porcoes: [
                { 
                    id: 20, 
                    nome: "Batata Frita", 
                    descricao: "Porção grande com cheddar e bacon", 
                    preco: 25.00, 
                    imagem: "imagens/batata.jpg",
                    adicionais: [
                        { nome: "Cheddar Extra", preco: 5.00 },
                        { nome: "Bacon Extra", preco: 6.00 }
                    ]
                }
            ],
            promocoes: [
                { 
                    id: 30, 
                    nome: "Combo Família", 
                    descricao: "2 X-Burger + 1 Batata Grande + 2 Refris", 
                    preco: 55.00, 
                    imagem: "imagens/combo.jpg",
                    adicionais: []
                }
            ]
        };

        // Renderizar o Cardápio
        function renderizarCardapio() {
            for (const categoria in cardapio) {
                const section = document.getElementById(categoria);
                section.innerHTML = '';
                
                cardapio[categoria].forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'menu-item';
                    itemElement.innerHTML = `
                        <img src="${item.imagem}" alt="${item.nome}">
                        <div class="item-info">
                            <h3>${item.nome}</h3>
                            <p>${item.descricao}</p>
                            <div class="item-price">R$ ${item.preco.toFixed(2).replace('.', ',')}</div>
                            <button class="btn add-to-cart" data-item-id="${item.id}">Adicionar</button>
                        </div>
                    `;
                    
                    // Modal de Adicionais
                    const modalElement = document.createElement('div');
                    modalElement.className = 'addons-modal';
                    modalElement.id = `addons-modal-${item.id}`;
                    
                    let addonsHTML = '';
                    if (item.adicionais && item.adicionais.length > 0) {
                        addonsHTML = item.adicionais.map((addon, index) => `
                            <div class="addon-item">
                                <input type="checkbox" id="addon-${item.id}-${index}" data-price="${addon.preco}">
                                <label for="addon-${item.id}-${index}">${addon.nome} (+R$ ${addon.preco.toFixed(2).replace('.', ',')})</label>
                            </div>
                        `).join('');
                    } else {
                        addonsHTML = '<p>Nenhum adicional disponível para este item.</p>';
                    }
                    
                    modalElement.innerHTML = `
                        <div class="modal-content">
                            <span class="close-addons">&times;</span>
                            <h3>${item.nome} - Adicionais</h3>
                            <div class="addons-list">
                                ${addonsHTML}
                            </div>
                            <div class="quantity-control">
                                <button class="qty-minus">-</button>
                                <input type="number" value="1" min="1" class="qty-input">
                                <button class="qty-plus">+</button>
                            </div>
                            <button class="btn btn-primary confirm-addons">Confirmar</button>
                        </div>
                    `;
                    
                    section.appendChild(itemElement);
                    section.appendChild(modalElement);
                });
            }
        }

        // Sistema de Filtros
        function setupCategoryFilters() {
            const categoryButtons = document.querySelectorAll('.category-btn');
            
            categoryButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove a classe active de todos os botões
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // Adiciona a classe active ao botão clicado
                    this.classList.add('active');
                    
                    // Esconde todas as seções
                    document.querySelectorAll('.menu-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // Mostra a seção correspondente
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                });
            });
        }

        // Carrinho de Compras
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        function updateCartCount() {
            const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
            document.querySelector('.cart-count').textContent = totalItems;
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            const notificationMessage = document.getElementById('notification-message');
            
            notificationMessage.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function addToCart(itemId, itemName, basePrice, addOns, quantity) {
            // Verificar se já existe um item igual no carrinho
            const existingItemIndex = cart.findIndex(item => 
                item.itemId === itemId && 
                JSON.stringify(item.addOns) === JSON.stringify(addOns)
            );
            
            if (existingItemIndex !== -1) {
                // Se já existe, apenas aumenta a quantidade
                cart[existingItemIndex].quantity += quantity;
            } else {
                // Se não existe, adiciona novo item
                cart.push({
                    itemId,
                    itemName,
                    basePrice,
                    addOns,
                    quantity
                });
            }
            
            // Atualizar localStorage e interface
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartDisplay();
            updateCartCount();
            
            // Mostrar notificação
            showNotification(`${quantity}x ${itemName} adicionado(s) ao carrinho!`);
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartDisplay();
            updateCartCount();
        }

        function updateCartDisplay() {
            const cartItemsContainer = document.getElementById('cart-items');
            const cartSubtotal = document.getElementById('cart-subtotal');
            const cartTotal = document.getElementById('cart-total');
            
            cartItemsContainer.innerHTML = '';
            
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p>Seu carrinho está vazio</p>';
                cartSubtotal.textContent = 'R$ 0,00';
                cartTotal.textContent = 'R$ 5,00'; // Taxa de entrega mínima
                return;
            }
            
            let subtotal = 0;
            
            cart.forEach((item, index) => {
                const cartItemElement = document.createElement('div');
                cartItemElement.className = 'cart-item';
                
                // Calcular preço do item com adicionais
                const addOnsPrice = item.addOns.reduce((total, addOn) => total + addOn.price, 0);
                const itemTotalPrice = (item.basePrice + addOnsPrice) * item.quantity;
                subtotal += itemTotalPrice;
                
                // Criar string de adicionais
                let addOnsText = '';
                if (item.addOns.length > 0) {
                    addOnsText = item.addOns.map(addOn => addOn.name).join(', ');
                }
                
                cartItemElement.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.quantity}x ${item.itemName}</div>
                        ${addOnsText ? `<div class="cart-item-addons">${addOnsText}</div>` : ''}
                    </div>
                    <div class="cart-item-price">R$ ${itemTotalPrice.toFixed(2).replace('.', ',')}</div>
                    <div class="cart-item-remove"><i class="fas fa-trash"></i></div>
                `;
                
                // Adicionar evento de remover item
                cartItemElement.querySelector('.cart-item-remove').addEventListener('click', () => {
                    removeFromCart(index);
                });
                
                cartItemsContainer.appendChild(cartItemElement);
            });
            
            // Atualizar totais
            const deliveryFee = 5.00;
            const total = subtotal + deliveryFee;
            
            cartSubtotal.textContent = `R$ ${subtotal.toFixed(2).replace('.', ',')}`;
            cartTotal.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
        }

        // Finalizar pedido via WhatsApp
        function setupCheckout() {
            document.getElementById('checkout-btn').addEventListener('click', function() {
                if (cart.length === 0) {
                    alert('Seu carrinho está vazio!');
                    return;
                }
                
                const user = JSON.parse(localStorage.getItem('user'));
                if (!user) {
                    alert('Você precisa estar logado para finalizar o pedido!');
                    return;
                }
                
                // Formatando a mensagem para o WhatsApp
                let message = `*NOVO PEDIDO - LANCHONETE DELÍCIA*%0A%0A`;
                message += `*Cliente:*%0A`;
                message += `Nome: ${user.name}%0A`;
                message += `Telefone: ${user.phone}%0A`;
                message += `Endereço: ${user.address}%0A`;
                if (user.cpf) {
                    message += `CPF: ${user.cpf}%0A`;
                }
                
                message += `%0A*Itens do Pedido:*%0A%0A`;
                
                let total = 0;
                
                cart.forEach(item => {
                    const addOnsPrice = item.addOns.reduce((sum, addOn) => sum + addOn.price, 0);
                    const itemPrice = (item.basePrice + addOnsPrice) * item.quantity;
                    total += itemPrice;
                    
                    message += `${item.quantity}x ${item.itemName}`;
                    
                    if (item.addOns.length > 0) {
                        message += `%0A`;
                        item.addOns.forEach(addOn => {
                            message += `  - ${addon.name}%0A`;
                        });
                    }
                    
                    message += `  Total: R$ ${itemPrice.toFixed(2).replace('.', ',')}%0A%0A`;
                });
                
                message += `*Subtotal:* R$ ${total.toFixed(2).replace('.', ',')}%0A`;
                message += `*Taxa de Entrega:* R$ 5,00%0A`;
                message += `*Total do Pedido:* R$ ${(total + 5).toFixed(2).replace('.', ',')}%0A%0A`;
                message += `*Obrigado pelo seu pedido!*`;
                
                // Limpar carrinho
                cart = [];
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartDisplay();
                updateCartCount();
                
                // Abrir WhatsApp
                const phone = user.phone.replace(/\D/g, '');
                window.open(`https://wa.me/55${phone}?text=${message}`, '_blank');
            });
        }

        // Configurar eventos dos botões "Adicionar"
        function setupAddToCartButtons() {
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('add-to-cart')) {
                    const itemId = e.target.getAttribute('data-item-id');
                    const itemCard = e.target.closest('.menu-item');
                    const itemName = itemCard.querySelector('h3').textContent;
                    const basePrice = parseFloat(itemCard.querySelector('.item-price').textContent.replace('R$ ', '').replace(',', '.'));
                    
                    // Abrir modal de adicionais
                    const addonsModal = document.getElementById(`addons-modal-${itemId}`);
                    addonsModal.style.display = 'flex';
                    
                    // Configurar botão de confirmar no modal
                    const confirmBtn = addonsModal.querySelector('.confirm-addons');
                    
                    confirmBtn.onclick = function() {
                        // Obter adicionais selecionados
                        const addOns = [];
                        const checkboxes = addonsModal.querySelectorAll('.addon-item input:checked');
                        checkboxes.forEach(checkbox => {
                            addOns.push({
                                name: checkbox.nextElementSibling.textContent.replace(/ \(\+R\$\s\d+,\d+\)/, ''),
                                price: parseFloat(checkbox.dataset.price)
                            });
                        });
                        
                        // Obter quantidade
                        const quantity = parseInt(addonsModal.querySelector('.qty-input').value);
                        
                        // Adicionar ao carrinho
                        addToCart(itemId, itemName, basePrice, addOns, quantity);
                        
                        // Fechar modal
                        addonsModal.style.display = 'none';
                    };
                }
            });
        }

        // Fechar modais de adicionais
        function setupCloseAddonsModals() {
            document.querySelectorAll('.close-addons').forEach(button => {
                button.addEventListener('click', function() {
                    this.closest('.addons-modal').style.display = 'none';
                });
            });
        }

        // Controles de quantidade nos modais
        function setupQuantityControls() {
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('qty-minus')) {
                    const input = e.target.nextElementSibling;
                    if (parseInt(input.value) > 1) {
                        input.value = parseInt(input.value) - 1;
                    }
                }
                
                if (e.target.classList.contains('qty-plus')) {
                    const input = e.target.previousElementSibling;
                    input.value = parseInt(input.value) + 1;
                }
            });
        }

        // Configurações da Conta
        function setupAccountModal() {
            const accountSettings = document.getElementById('account-settings');
            const accountModal = document.getElementById('account-modal');
            const closeAccount = document.querySelector('.close-account');
            
            // Abrir/fechar modal de conta
            accountSettings.addEventListener('click', function(e) {
                e.preventDefault();
                accountModal.style.display = 'flex';
                loadAccountData();
            });
            
            closeAccount.addEventListener('click', function() {
                accountModal.style.display = 'none';
            });
            
            // Fechar modal ao clicar fora
            window.addEventListener('click', function(e) {
                if (e.target === accountModal) {
                    accountModal.style.display = 'none';
                }
            });
            
            // Carregar dados da conta
            function loadAccountData() {
                const user = JSON.parse(localStorage.getItem('user')) || {};
                document.getElementById('account-name').value = user.name || '';
                document.getElementById('account-phone').value = user.phone || '';
                document.getElementById('account-address').value = user.address || '';
                document.getElementById('account-cpf').value = user.cpf || '';
            }
            
            // Salvar dados da conta
            document.getElementById('account-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const user = JSON.parse(localStorage.getItem('user')) || {};
                const newPassword = document.getElementById('account-password').value;
                const confirmPassword = document.getElementById('account-confirm-password').value;
                
                if (newPassword && newPassword !== confirmPassword) {
                    alert('As senhas não coincidem!');
                    return;
                }
                
                // Atualizar dados do usuário
                user.phone = document.getElementById('account-phone').value;
                user.address = document.getElementById('account-address').value;
                user.cpf = document.getElementById('account-cpf').value;
                
                if (newPassword) {
                    user.password = newPassword;
                }
                
                // Simular atualização no banco de dados
                localStorage.setItem('user', JSON.stringify(user));
                
                alert('Dados atualizados com sucesso!');
                accountModal.style.display = 'none';
            });
        }

        // Máscaras para os campos
        function setupInputMasks() {
            const phoneInputs = document.querySelectorAll('input[type="text"][id*="phone"]');
            phoneInputs.forEach(input => {
                input.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length > 11) value = value.substring(0, 11);
                    
                    if (value.length > 0) {
                        value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
                        if (value.length > 10) {
                            value = value.replace(/(\d)(\d{4})$/, '$1-$2');
                        } else {
                            value = value.replace(/(\d)(\d{3})$/, '$1-$2');
                        }
                    }
                    
                    e.target.value = value;
                });
            });
            
            const cpfInputs = document.querySelectorAll('input[type="text"][id*="cpf"]');
            cpfInputs.forEach(input => {
                input.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length > 11) value = value.substring(0, 11);
                    
                    if (value.length > 0) {
                        value = value.replace(/^(\d{3})(\d)/, '$1.$2');
                        value = value.replace(/^(\d{3})\.(\d{3})(\d)/, '$1.$2.$3');
                        value = value.replace(/^(\d{3})\.(\d{3})\.(\d{3})(\d)/, '$1.$2.$3-$4');
                    }
                    
                    e.target.value = value;
                });
            });
        }

        // Logout
        function setupLogout() {
            document.getElementById('logout').addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('user');
                window.location.href = 'index.html';
            });
        }

        // Carrinho Sidebar
        function setupCartSidebar() {
            const cartIcon = document.getElementById('cart-icon');
            const cartSidebar = document.getElementById('cart-sidebar');
            const closeCart = document.querySelector('.close-cart');
            
            cartIcon.addEventListener('click', function() {
                cartSidebar.classList.add('open');
            });
            
            closeCart.addEventListener('click', function() {
                cartSidebar.classList.remove('open');
            });
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Simular usuário logado (para teste)
            if (!localStorage.getItem('user')) {
                localStorage.setItem('user', JSON.stringify({
                    name: "Cliente Teste",
                    phone: "(11) 99999-9999",
                    address: "Rua Exemplo, 123",
                    cpf: "123.456.789-00"
                }));
            }
            
            renderizarCardapio();
            setupCategoryFilters();
            setupAddToCartButtons();
            setupCloseAddonsModals();
            setupQuantityControls();
            setupCartSidebar();
            setupAccountModal();
            setupInputMasks();
            setupLogout();
            setupCheckout();
            
            // Inicializar carrinho
            updateCartDisplay();
            updateCartCount();
        });
    </script>
</body>
</html>